Linux根文件系统

一.虚拟文件系统
1. Linux支持ext,ext2,xia,minix,umsdos,msdes,fat32,ntfs,proc,stub,ncp,hpfs,affs以及ufs等多种文件系统。
Linux对所有的文件系统采用统一-的文件界面,用户通过文件的操作界面来实现对不同文件系统的操作。对于用户来说,我们不要去关心不同文件系统的具体操作
过程,而只是对一一个虚拟的文件操作界面来进行操作,这个操作界面就是Linux的虚拟文件系统(VFS )。VFS作为Linux内核中的一一个软件层,用于给用户空间的
程序提供文件系统接口,同时也提供了内核中的一个抽象功能，允许不同的文件系统很好地共存。VFS使Linux同时安装、支持许多不同类型的文件系统成为可能。V
FS拥有关于各种特殊文件系统的公共界面,如超级块、inode、文件操作函数入口等。实际文件系统的细节，统一由VFS的公共界面来索引,它们对系统核心和用户进
程来说是透明的。
2. 常用的嵌入式文件系统
1）Ext2fs
是Linux事实上的标准文件系统，它已经取代了它的前任—---扩展文件系统（或Extfs）。
Extfs支持的文件大小最大为2GB，支持的最大文件名称大小为255个字符------而且它不支持索引节点（包括数据修改时间标记）。
Ext2fs支持达4TB的内存。
Ext2fs文件名称最长可以到1012个字符。
当创建文件系统时，管理员可以选择逻辑块的大小（通常大小可选择 1024、2048和 4096 字节）。
Ext2fs了实现快速符号链接：不需要为此目的而分配数据块，并且将目标名称直接存储在索引节点（inode）表中。这使性能有所提高，特别是在速度上。
2）RomFS
uClinux系统多采用Romfs文件系统, Romfs是一种相对简单、占用空间较少的文件系统。
空间的节约来自于两个方面:首先内核支持Romfs文件系统比支持ext2文件系统需要更少的代码;
其次romfs文件系统相对简单,在建立文件系统超级块( Superblock )需要更少的存储空间。
Romfs是只读的文件系统,禁止写操作因此系统同时需要虚拟盘（RAMDISK）支持临时文件和数据文件的存储。
只读文件系统，可以放在ROM空间,也可以在系统的RAM中,嵌入式linux中常用来作根文件系统。
3）CRAMFS
CRAMFS中的数据已被压缩,属于只读性文件系统,不能在闪存中修改。用户想获取数据时,CRAMFS先把数据送到RAM中,用户从RAM中读取。一般CRAMFS的上层为RAM
FS文件系统,经修改过的文件都保存在RAM中。RAMFS和CRAMFS结合的缺陷在于, 一旦出现掉电等特殊情况,保存在RAMFS中的修改数据将全部丢失。
4）JFFS
JFFS2是比较常用的嵌入式日志文件系统。
JFFS2在扇区级别上执行闪存擦除/写/读操作要比Ext2文件系统好。JFFS2提供了比Ext2fs更好的崩溃/掉电安全保护。
当需要更改少量数据时,Ext2文件系统将整个扇区复制到内存（DRAM）中,在内存中合并新数据,并写回整个扇区。这意味着为了更改单个字，必须对整个扇区(64
KB)执行读/擦除/写例程这样做的效率非常低。要是运气差，当正在DRAM中合并数据时，发生了电源故障或其它事故,那么将丢失整个数据集合,因为在将数据读入
DRAM后就擦除了闪存扇区。JFFS2附加文件而是重写整个扇区,并且具有崩溃/掉电安全保护这一功能。
5）Yaffs
Yaffs(Yet Another Flash File System)文件系统是专门针对NAND闪存设计的嵌入式文件系统，目前有Yaffs和Yaffs两个版本,两个版本的主要区别之一在
于Yaffs2能够更好地支持大容量的NANDFlash芯片。
专门为Nandflash设计的日志文件系统,提供磨损平衡和调电恢复的鲁棒性。Yaffs将文件组织成固定大小（512B）的数据段,在进行文件修改时,总是先写入新的
数据块，然后将旧的的数据块从文件中删除。

二.根文件系统
1. 根文件系统就是一种目录结构，根文件系统包括Linux启动时所必需的目录和关键性的文件。例如Linux启动时都需要有init日录下的相关文件，在Linux挂载
分区时Linux一定会找/etc/fstab这个挂载文件系统等，根文件系统中还包括了许多的应用程序bin目录等。
2. 基本根文件系统目录构成解析：
目录名称   含义
/bin       存放二进制程序，如:Is,cp
/boot      存放系统启动的一-些程序
/dev       存放设备文件
/etc       存放系统配置文件,如: group , profile
/home      用户根目录
/lib       存放库文件
/media     媒介的挂载点，如:闪存
/mnt       该目录用来为其他文件系统提供安装点
/opt       不随发行版本一起交付的程序
/proc      proc文件系统
/root      超级用户根目录
/sbin      存放超级用户运行的二进制文件
/src       存放一些服务的目录
/sys       sys文件系统的目录
/var       存放经常变化的文件,如临时文件等
3. 根文件系统的基本结构：
1）/bin、/dev、/etc、/lib、/proc、/sbin和/usr，都是不可或缺的。
2）为多用户提供可扩展环境的所有目录(例如/home、/mnt、/opt和/root)可以省略。
3）调整根文件系统的时候，我们甚至可以进一步移除/tmp和/var，不过这么做可能会危害到某些软件的运行。因此不建议采用这种过于简化的做法。
4. 二进制目录
在根文件系统上，存放二进制文件的目录主要有四个/bin、/sbin、/usr/bin和/usr/sbin。
二进制文件要放在其中哪个目录，这与它在系统中所扮演的角色有很大的关系。
如果这是用户和系统管理员必备的二进制文件，就会放在/bin。
如果这是系统管理员必备、但是一般用户根本不会用到的二进制工件，就会放在/sbin。
相对而言，如果不是用户必备的二进制文件，多半会放在/usr/bin；如果不是系统管理必备的工具，多半会放在/usr/sbin。
5. 链接库目录Lib
1）至于链接库的摆放位置，也是同样的道理。系统引导以及执行最基本命令需要的链接库会摆在/lib。
所有其他的链接库则会摆在/usr/lib。通常，套件安装时，会在/usr/lib中产生子目录，以便摆放它自己的链接库。
以Perl 5.x为例，它会产生/usr/lib/perl5目录，里自摆放的都是与Perl有关的链接库和模块。
2）实际的共享链接库
这类文件的文件名格式为libLIBRARY_NAME-VERSION.so其中。LBRARY_NAME是链接库的名称，VERSION是你使用的链接库的版本编号。
例如，glibc 2.2.3的数学链接库的名称为libm-2.2.3.so。
3）主修订版本的符号链接
主修订版本的编号方式与实际的版本号不同。以glibc 2.2.3实际的共享C链接库libc-2.2.3.so为例，它的主修订版本编号为6。
相对而言，libdl-2.2.3. so的主修订版本编号为2。主修订版本的符号链接的名称格式为libLIBRARY_NAME.so.MAJOR_REVISION _VERSION,其中
MAJOR_REVISION_VERSION是链接库的主修订版本编号。以实际的C链接库为例，其符号链接的名称为libc.so.6。libdl则是libdl.so.2。
4）与版本无关的符号链接指向主修订版本的符号链接
这些符号链接的主要功能，是为需要链接特定链接库的所有程序提供一个通用的条目，与主修订版本的编号或glibc涉及的版本无关。这些符号链接典型的格式为
libLIBRARY_NAME.so.例如，libm. so指向libm.so.6，libm.so.6指向实际的共享链接库libm-2.2.3.so。
5）静态链接库文件
选择以静态方式链接链接库的应用程序便会使用这些静态库文件。这些包的文件名格式为IibLIBRARY_NAME.a，例如libdl的静态包文件就是libdl.a。
6. 设备文件目录/dev/
选择用devfs(设备文件系统)来取代固定的静态设备文件，则可免去寻找设备信息的麻烦。
内核源码树的Documentation/devices.txt文档就是静态设备主要和次要编号的正式信包来源。
基本的/dev条目：
文件名    说明                              类型  主编号  次编号   仅限位
mem       物理内存存取                      字符    	1      1      600
null      null(黑洞)设备(译注1)            字符集   	1      3      666
zero      以null byte(零值字节)为数据来源   字符    	1      5      666
random    真随机数产生器                   字符     	1      8      644
try0      现行的虚拟控制台                 字符     	4      0      600
tty1      第一个虚拟控制台                 字符     	4      1      600
tlyS0     第一个UART串行端口               字符     	4      64     600
tty       现行的TTY设备                    字符    	5      0      666
console   系统控制台                       字符     	5      1      600